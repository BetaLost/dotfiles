" PLUGINS - Vim Plug
call plug#begin()

Plug 'nvim-tree/nvim-web-devicons' " Colored icons
Plug 'akinsho/bufferline.nvim', { 'tag': '*' } " File tabs

Plug 'nvim-lualine/lualine.nvim' " Statusline

Plug 'windwp/nvim-autopairs' " Autopair
Plug 'alvan/vim-closetag' " Auto close HTML tags

Plug 'MunifTanjim/nui.nvim' " UI Library, Neotree dependency
Plug 'nvim-lua/plenary.nvim' " Neotree dependency
Plug 'nvim-neo-tree/neo-tree.nvim' " Neotree file explorer

Plug 'lilydjwg/colorizer' " Visualize hex colors
Plug 'loctvl842/monokai-pro.nvim' " Colorscheme
Plug 'nvim-treesitter/nvim-treesitter', { 'do': ':TSUpdate' } " Syntax highlighting

Plug 'karb94/neoscroll.nvim' " Scroll animation

Plug 'lukas-reineke/indent-blankline.nvim' " Indent visualization

" Autocomplete
Plug 'neovim/nvim-lspconfig' " Quickstart configs for Nvim LSP
Plug 'onsails/lspkind.nvim' " Vscode-like pictograms
Plug 'hrsh7th/cmp-nvim-lsp'
Plug 'hrsh7th/cmp-nvim-lsp-signature-help'
Plug 'hrsh7th/cmp-buffer'
Plug 'hrsh7th/cmp-path'
Plug 'hrsh7th/cmp-cmdline'
Plug 'hrsh7th/nvim-cmp'
Plug 'hrsh7th/cmp-vsnip'
Plug 'hrsh7th/vim-vsnip'

call plug#end()

" GENERAL CONFIGURATION
filetype indent on
syntax on
set number
set ts=4 sw=4
set signcolumn=no
set pastetoggle=<F2>
set ttimeoutlen=0
set completeopt=menu,menuone,noselect
set pumheight=10
set ignorecase
set smartcase

" KEYBINDS

" NeoTree
nnoremap <C-t> :Neotree toggle<CR>

" Copy to system clipboard 
nmap <C-A-c> "+y$

" Manage Tabs
map <A-.> <Cmd>bnext<CR>
map <A-,> <Cmd>bprev<CR>
map <A-c> <Cmd>bdelete<CR>

" Restore terminal cursor on exit
autocmd VimLeave * set guicursor=a:ver25-blinkon1

lua <<EOF
	-- Colorscheme
	require("monokai-pro").setup({
		filter = "spectrum", -- classic | octagon | pro | machine | ristretto | spectrum
	})
	vim.cmd([[colorscheme monokai-pro]])
	
	-- File tabs
	require("bufferline").setup({options = {
		separator_style = "slant",
		indicator = {
			style = "none",
		},
		buffer_close_icon = '',
		close_icon = '',
		modified_icon = '●',
		left_trunc_marker = '',
		right_trunc_marker = '',
		diagnostics = "nvim_lsp",
		show_buffer_icons = true,
		show_buffer_close_icons = true,
		show_close_icon = true,
		persist_buffer_sort = true,
		enforce_regular_tabs = true,
		diagnostics_indicator = function(count, level)
			local icon = level:match("error") and "" or ""
			return icon .. " " .. count
		end
	}})
	
	-- Statusline
	require("lualine").setup({
		options = {
			theme = "monokai-pro",
			section_separators = { left = '', right = '' },
			disabled_filetypes = { -- Recommended filetypes to disable winbar
				winbar = { "gitcommit", "neo-tree", "toggleterm", "fugitive" },
			},
		},
		winbar = winbar,
		inactive_winbar = winbar,
	})
	
	-- Setup File Explorer
	require("neo-tree").setup({
		close_if_last_window = true,
		symbols = false,
		default_component_configs = {
			symbols = false
		},
		git_status = {
			symbols = false
		},
		window = {
			width = 25
		},
		filesystem = {
			filtered_items = {
				visible = true,
				hide_dotfiles = false,
				hide_gitignored = false,
			}
		}
	})
	
	-- Syntax Highlighting
	require("nvim-treesitter.configs").setup {
		ensure_installed = { "c", "lua", "rust", "python" },
		sync_install = false,
		auto_install = true,
		ignore_install = {},
		
		highlight = {
			enable = true,
			disable = {},
			additional_vim_regex_highlighting = false
		},
	}
	
	-- Scroll animation
	require("neoscroll").setup({
		easing_function = "quadratic"
	})

	local t = {}
	t["<ScrollWheelUp>"] = {"scroll", {"-vim.wo.scroll", "true", "200"}}
	t["<ScrollWheelDown>"] = {"scroll", { "vim.wo.scroll", "true", "200"}}
	t["gg"] = {"scroll", {"-vim.api.nvim_buf_line_count(0)", "true", "500"}}
	t["G"] = {"scroll", {"vim.api.nvim_buf_line_count(0)", "true", "500"}}
	
	require("neoscroll.config").set_mappings(t)
	
	-- Indent visualization
	local highlight = {
		"Red",
		"Yellow",
		"Green",
		"Blue",
		"Magenta",
	}
	
	local hooks = require("ibl.hooks")
	hooks.register(hooks.type.HIGHLIGHT_SETUP, function()
		vim.api.nvim_set_hl(0, "Red", { fg = "#ff618d" })
		vim.api.nvim_set_hl(0, "Yellow", { fg = "#fce566" })
		vim.api.nvim_set_hl(0, "Green", { fg = "#7bd88f" })
		vim.api.nvim_set_hl(0, "Blue", { fg = "#5ad4e6" })
		vim.api.nvim_set_hl(0, "Magenta", { fg = "#948ae3" })
	end)
	
	require("ibl").setup({
		indent = {
			char = "▏",
			tab_char = "▏",
			highlight = highlight,
		}
	})
	
	-- Autocomplete
	local lspkind = require("lspkind")
	local cmp = require("cmp")
	cmp.setup({
		window = {
			completion = cmp.config.window.bordered(),
			documentation = cmp.config.window.bordered(),
		},
		
		formatting = {
			format = lspkind.cmp_format({
				mode = "symbol_text",
				maxwidth = 50,
				ellipsis_char = "...",
			})
		},
		
		snippet = {
			expand = function(args)
				vim.fn["vsnip#anonymous"](args.body)
			end
		},
		
		mapping = cmp.mapping.preset.insert({
			["<C-b>"] = cmp.mapping.scroll_docs(-4),
			["<C-f>"] = cmp.mapping.scroll_docs(4),
			["<C-Space>"] = cmp.mapping.complete(),
			["<C-e>"] = cmp.mapping.abort(),
			["<Tab>"] = cmp.mapping.confirm({ select = true })
		}),
		
		sources = cmp.config.sources({
				{ name = "nvim_lsp" },
				{ name = "vsnip" },
				{ name = "nvim_lsp_signature_help" }
			}, {
				{ name = "buffer" }
		})
	})
	
	local capabilities = require("cmp_nvim_lsp").default_capabilities()
	
	local servers = {
		"pyright", -- Python
		"tsserver", -- Javascript
		"rust_analyzer", -- Rust
		"clangd", -- C/C++
		"html", -- HTML
		"cssls", -- CSS
	}
	
	for _, lsp in ipairs(servers) do
		require("lspconfig")[lsp].setup {
			capabilities = capabilities,
		}
	end

	require("lspconfig")["lua_ls"].setup {
		capabilities = capabilities,
		settings = { Lua = { diagnostics = { globals = { "vim" } } } }
	}
	
	-- Close Pairs
	require("nvim-autopairs").setup({})
	local cmp_autopairs = require("nvim-autopairs.completion.cmp")
	cmp.event:on("confirm_done", cmp_autopairs.on_confirm_done())
EOF
